<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chat con HTTP+WS - Identificaci√≥n por IP</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        
        h3 {
            text-align: center;
            color: #333;
        }
        
        #log {
            border: 1px solid #ccc;
            height: 400px;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            font-family: monospace;
            font-size: 14px;
        }
        
        .message {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .user-message {
            background-color: #e3f2fd;
            border-left: 3px solid #2196f3;
        }
        
        .system-message {
            background-color: #fff3e0;
            border-left: 3px solid #ff9800;
            font-style: italic;
        }
        
        .connection-message {
            background-color: #e8f5e8;
            border-left: 3px solid #4caf50;
            font-weight: bold;
        }
        
        .disconnection-message {
            background-color: #ffebee;
            border-left: 3px solid #f44336;
            font-weight: bold;
        }
        
        #input-container {
            display: flex;
            gap: 10px;
        }
        
        #msg {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        #send {
            padding: 10px 20px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        #send:hover {
            background-color: #45a049;
        }
        
        #status {
            text-align: center;
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .connected {
            background-color: #d4edda;
            color: #155724;
        }
        
        .disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h3>üí¨ Chat WebSocket - Identificaci√≥n por IP:Puerto</h3>
    
    <div id="status" class="disconnected">Desconectado</div>
    
    <!-- √Årea donde aparecen los mensajes -->
    <div id="log"></div>
    
    <!-- Campo de entrada y bot√≥n -->
    <div id="input-container">
        <input id="msg" placeholder="Escribe tu mensaje..." />
        <button id="send">Enviar</button>
    </div>

    <script>
        // Configuraci√≥n
        let ip = "192.168.0.11";
        let port = 8765;    // Puerto WebSocket (NO el puerto HTTP)

        const logDiv = document.getElementById("log");
        const statusDiv = document.getElementById("status");
        const msgInput = document.getElementById("msg");
        const sendButton = document.getElementById("send");

        // üÜï Funci√≥n mejorada para mostrar mensajes con estilos
        const log = (message, type = 'user') => {
            const time = new Date().toLocaleTimeString();
            const messageDiv = document.createElement("div");
            messageDiv.className = "message";
            
            // Aplicar estilos seg√∫n el tipo de mensaje
            if (message.includes("üü¢") || message.includes("se ha unido")) {
                messageDiv.className += " connection-message";
            } else if (message.includes("üî¥") || message.includes("ha salido")) {
                messageDiv.className += " disconnection-message";
            } else if (message.includes("‚úÖ") || message.includes("‚ùå") || message.includes("‚ö†")) {
                messageDiv.className += " system-message";
            } else {
                messageDiv.className += " user-message";
            }
            
            messageDiv.innerHTML = `<strong>[${time}]</strong> ${message}`;
            logDiv.appendChild(messageDiv);
            logDiv.scrollTop = logDiv.scrollHeight;  // Scroll autom√°tico
        };

        // üÜï Funci√≥n para actualizar estado de conexi√≥n
        const updateStatus = (status, connected) => {
            statusDiv.textContent = status;
            statusDiv.className = connected ? "connected" : "disconnected";
        };

        // Crear conexi√≥n WebSocket
        const socket = new WebSocket(`ws://${ip}:${port}`);

        // Eventos WebSocket
        socket.onopen = () => {
            log("‚úÖ Conectado al chat");
            updateStatus("üü¢ Conectado al servidor", true);
        };
        
        socket.onmessage = (e) => {
            log(e.data);  // Mostrar mensaje recibido (ya viene formateado desde el servidor)
        };
        
        socket.onclose = () => {
            log("‚ùå Desconectado del chat");
            updateStatus("üî¥ Desconectado del servidor", false);
        };
        
        socket.onerror = () => {
            log("‚ö† Error en conexi√≥n");
            updateStatus("‚ö† Error de conexi√≥n", false);
        };

        // üÜï Funci√≥n mejorada para enviar mensajes
        const sendMessage = () => {
            const message = msgInput.value.trim();
            
            if (message && socket.readyState === WebSocket.OPEN) {
                socket.send(message);           // Enviar al servidor
                msgInput.value = "";            // Limpiar campo
                msgInput.focus();               // Mantener foco en el input
            }
        };

        // Eventos de la interfaz
        sendButton.onclick = sendMessage;

        // Enviar mensaje con Enter
        msgInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                sendMessage();
            }
        });

        // üÜï Auto-focus en el campo de mensaje
        window.onload = () => {
            msgInput.focus();
        };
    </script>
</body>
</html>